<!DOCTYPE html>
<html>

<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
<meta charset="utf-8" />
<meta http-equiv='X-UA-Compatible' content='IE=edge'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>
<title>Khoa há»c dá»¯ liá»‡u</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<!-- Style for main home page -->
<link rel="stylesheet" href="/assets/css/styles.css">
<link rel="stylesheet" href="/assets/css/styles_toc.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script data-ad-client="ca-pub-4263248182804679" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script> 
<link href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> -->
<link href="https://fonts.googleapis.com/css?family=Roboto|Source+Sans+Pro" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Fira+Sans" rel="stylesheet">
<link rel="icon" type="image/jpg" href="assets/images/logo.jpg" sizes="32x32">
<link rel="canonical" href="https://phamdinhkhanh.github.io"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="author" content="Pháº¡m ÄÃ¬nh KhÃ¡nh" />
<meta property="og:title" content="" />
<meta property="og:site_name" content="Khanh's blog" />
<meta property="og:url" content="https://phamdinhkhanh.github.io" />
<meta property="og:description" content="" />

<meta property="og:type" content="article" />
<meta property="article:published_time" content="" />


<meta property="article:author" content="Khanh" />
<meta property="article:section" content="" />

<link rel="alternate" type="application/atom+xml" title="Khanh's blog - Atom feed" href="/feed.xml" />
<style>
	
</style>
<!-- -- Import latext  -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
	skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
	inlineMath: [['$','$']]
  }
});
</script>

<!-- Google Analytics -->

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-89509207-1', 'auto');
// ga('send', 'pageview');
ga('send', 'pageview', {
'page': '/',
'title': ''
});
</script>


<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KTCD8BX');</script>
<!-- End Google Tag Manager -->
</head>
<style>
body {
  padding: 0 7.5%;
}
</style>

<body>
	<div id="fb-root"></div>
	<!-- <script>(function(d, s, id) { -->
	  <!-- var js, fjs = d.getElementsByTagName(s)[0]; -->
	  <!-- if (d.getElementById(id)) return; -->
	  <!-- js = d.createElement(s); js.id = id; -->
	  <!-- js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.9"; -->
	  <!-- fjs.parentNode.insertBefore(js, fjs); -->
	<!-- }(document, 'script', 'facebook-jssdk'));</script> -->
	<br>
	<div content = "container">
		<div class="row">
			<div class="col-md-2 hidden-xs hidden-sm">
				<a  href="/">
					<img width="100%" style="padding-bottom: 3mm;" src="/assets/images/img.jpg" /> </a>
				<br>
				<nav>
					<div class="header">Latest</div>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/09/19/MobileNet.html">BÃ i 48 - Mobilenet model</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/08/23/FocalLoss.html">BÃ i 47 - Focal Loss trong RetinaNet</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/08/13/ModelMetric.html">BÃ i 46 - ÄÃ¡nh giÃ¡ mÃ´ hÃ¬nh phÃ¢n loáº¡i trong ML</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/08/09/ConditionalGAN.html">BÃ i 45 - Conditional GAN (CGAN)</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/07/25/GAN_Wasserstein.html">BÃ i 44 - Model Wasserstein GAN (WGAN)</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/07/13/GAN.html">BÃ i 43 - Model GAN</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/06/20/Unet.html">BÃ i 42 - Thá»±c hÃ nh Unet</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/06/18/DeepLab.html">BÃ i 41 - DeepLab Sentiment Segmentation</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/06/10/ImageSegmention.html">BÃ i 40 - Image Segmentation</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/06/04/PhoBERT_Fairseq.html">BÃ i 39 - Thá»±c hÃ nh á»©ng dá»¥ng BERT</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/05/31/CNNHistory.html">BÃ i 38 - CÃ¡c kiáº¿n trÃºc CNN hiá»‡n Ä‘áº¡i</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/05/28/TransformerThemDauTV.html">BÃ i 37 - Transformer thÃªm dáº¥u Tiáº¿ng Viá»‡t</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/05/23/BERTModel.html">BÃ i 36 - BERT model</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/05/05/MultitaskLearning_MultiBranch.html">BÃ i 35 - Multitask Learning - Multi Branch</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/04/22/MultitaskLearning.html">BÃ i 34 - Multitask Learning</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/04/15/TransferLearning.html">BÃ i 33 - PhÆ°Æ¡ng phÃ¡p Transfer Learning</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/04/09/TensorflowDataset.html">BÃ i 32 - KÄ© thuáº­t tensorflow Dataset</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/04/03/AWS.html">BÃ i 31 - Amazon Virtual Machine Deep Learning</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/03/28/deployTensorflowJS.html">BÃ i 30 - XÃ¢y dá»±ng Web AI trÃªn tensorflow js</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/03/23/FlaskRestAPI.html">BÃ i 29 - XÃ¢y dá»±ng Flask API cho mÃ´ hÃ¬nh deep learning</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/03/21/faceNet.html">BÃ i 28 - Thá»±c hÃ nh training Facenet</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/03/12/faceNetAlgorithm.html">BÃ i 27 - MÃ´ hÃ¬nh Facenet trong face recognition</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/03/10/DarknetGoogleColab.html">BÃ i 26 - Huáº¥n luyá»‡n YOLO darknet trÃªn google colab</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/03/09/DarknetAlgorithm.html">BÃ i 25 - YOLO You Only Look Once</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/02/17/ImbalancedData.html">BÃ i 24 - Máº¥t cÃ¢n báº±ng dá»¯ liá»‡u (imbalanced dataset)</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/02/11/NARSyscom2015.html">BÃ i 23 - Neural Attentive Session-Based Recommendation</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/01/17/ScoreCard.html">BÃ i 22 - Scorecard model</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2020/01/06/ImagePreprocessing.html">BÃ i 21 - Tiá»n xá»­ lÃ½ áº£nh OpenCV</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/12/26/Sorfmax_Recommendation_Neural_Network.html">BÃ i 20 - Recommendation Neural Network</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/12/12/ARIMAmodel.html">BÃ i 19 - MÃ´ hÃ¬nh ARIMA trong time series</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/12/02/DeepLearningLayer.html">BÃ i 18 - CÃ¡c layers quan trá»ng trong deep learning</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/11/22/HOG.html">BÃ i 17 - Thuáº­t toÃ¡n HOG (Histrogram of oriented gradient)</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/11/08/RFMModel.html">BÃ i 16 - Model RFM phÃ¢n khÃºc khÃ¡ch hÃ ng</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/11/04/Recommendation_Compound_Part1.html">BÃ i 15 - collaborative vÃ  content-based filtering</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/10/22/googleHeatmap.html">BÃ i 14 - Biá»ƒu Ä‘á»“ trÃªn Google Map</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/10/05/SSDModelObjectDetection.html">BÃ i 13 - Model SSD trong Object Detection</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/09/29/OverviewObjectDetection.html">BÃ i 12 - CÃ¡c thuáº­t toÃ¡n Object Detection</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/09/16/VisualizationPython.html">BÃ i 11 - Visualization trong python</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/09/08/LDATopicModel.html">BÃ i 10 - Thuáº­t toÃ¡n LDA - XÃ¡c Ä‘á»‹nh Topic</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/08/25/PyTorch_Torchtext_Tutorial.html">BÃ i 9 - Pytorch - Buá»•i 3 - torchtext module NLP</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/08/22/convolutional-neural-network.html">BÃ i 8 - Convolutional Neural Network</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/08/19/CorrectSpellingVietnamseTonePrediction.html">BÃ i 7 - Pytorch - Buá»•i 2 - Seq2seq model correct spelling</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/08/10/PytorchTurtorial1.html">BÃ i 6 - Pytorch - Buá»•i 1 - LÃ m quen vá»›i pytorch</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/07/15/PySparkSQL.html">BÃ i 5 - Model Pipeline - SparkSQL</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/06/18/AttentionLayer.html">BÃ i 4 -  Attention is all you need</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/05/10/Hypothesis_Statistic.html">Apenddix 1 - LÃ½ thuyáº¿t phÃ¢n phá»‘i vÃ  kiá»ƒm Ä‘á»‹nh thá»‘ng kÃª</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/04/29/ModelWord2Vec.html">BÃ i 3 - MÃ´ hÃ¬nh Word2Vec</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/04/22/Ly_thuyet_ve_mang_LSTM.html">BÃ i 2 - LÃ½ thuyáº¿t vá» máº¡ng LSTM part 2</a></li>
					
					<li><a style="text-align: left; color: #074B80"  href="/2019/01/07/Ky_thuat_feature_engineering.html">BÃ i 1 - KÄ© thuáº­t feature engineering</a></li>
					
				</nav>
			</div>
			<div class="col-md-8 col-xs-12" style="z-index:1">
				<nav class="navbar navbar-inverse" style="background-color: #046897">
					<div class = "container-fluid">
						<div class = "navbar-header>
							<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
							</button>
							<a class="navbar-brand" href="/">
								<span style="color:#FFF">Khoa há»c dá»¯ liá»‡u - Khanh's blog</span>
							</a>
						</div>
						<br>
						<br>
						<div class="collapse navbar-collapse navbar-right" id="myNavbar">
							<ul class="nav navbar-nav">
								<li><a href="/home"><span style="color: #fff"> Home</span></a></li>
								<li><a href="/about"><span style="color: #fff"> About</span></a></li>
								<!-- <li><a href="/da"><span style="color: #fff">Data Analytics</span></a></li> -->
								<!-- <li><a href="/cv"><span style="color: #fff">Computer Vision</span></a></li> -->
								<!-- <li><a href="/nlp"><span style="color: #fff">NLP</span></a></li> -->
								<!-- <li><a href="/code"><span style="color: #fff">Code</span></a></li> -->
								<li><a href="/book"><span style="color: #fff">Book</span></a></li>
							</ul>
						</div>
					</div>
				</nav>
				<div class="PageNavigation">
				</div>
				<h1 itemprop="name" class="post-title"></h1>
				<div id="bootstrap-overrides">
					<div>
<h2><p class="post-link" style="text-align: left; color: #204081; font-weight: bold">BÃ i 26 - Huáº¥n luyá»‡n YOLO darknet trÃªn google colab</p></h2> 
<strong>10 Mar 2020 - phamdinhkhanh</strong>
</div>
<br/>
<div id="toc"></div>
<h1 id="1-giá»›i-thiá»‡u-chung">1. Giá»›i thiá»‡u chung</h1>

<p>á» bÃ i nÃ y tÃ´i sáº½ hÆ°á»›ng dáº«n cÃ¡c báº¡n huáº¥n luyá»‡n model YOLO trÃªn google colab qua cÃ¡c khÃ¢u:</p>

<ul>
  <li>Cáº¥u hÃ¬nh cÃ i Ä‘áº·t GPU.</li>
  <li>Chuáº©n bá»‹ dá»¯ liá»‡u.</li>
  <li>Cáº¥u hÃ¬nh mÃ´ hÃ¬nh.</li>
  <li>Huáº¥n luyá»‡n vÃ  dá»± bÃ¡o.</li>
</ul>

<p>QÃºa trÃ¬nh huáº¥n luyá»‡n YOLO sáº½ ráº¥t dá»… xáº£y ra lá»—i náº¿u chÆ°a cÃ³ kinh nghiá»‡m. ChÃ­nh vÃ¬ tháº¿ tÃ´i sáº½ tá»•ng káº¿t cÃ¡c lÆ°u Ã½ quan trá»ng vá» lá»—i khi huáº¥n luyá»‡n mÃ´ hÃ¬nh trÃªn darknet á»Ÿ cuá»‘i bÃ i. Äá»“ng thá»i tÃ´i cÅ©ng Ä‘Æ°a ra má»™t vÃ i tip giÃºp theo dÃµi quÃ¡ trÃ¬nh huáº¥n luyá»‡n vÃ  tÄƒng tá»‘c Ä‘á»™ huáº¥n luyá»‡n.</p>

<p>TrÆ°á»›c khi Ä‘á»c bÃ i hÆ°á»›ng dáº«n mang tÃ­nh cháº¥t thá»±c hÃ nh nÃ y, tÃ´i khuyáº¿n nghá»‹ cÃ¡c báº¡n hÃ£y Ä‘á»c hiá»ƒu lÃ½ thuyáº¿t mÃ´ hÃ¬nh Ä‘Ã£ Ä‘Æ°á»£c trÃ¬nh bÃ y á»Ÿ <a href="https://phamdinhkhanh.github.io/2020/03/09/DarknetAlgorithm.html">BÃ i 25 - YOLO You Only Look Once</a>. Äiá»u nÃ y sáº½ giÃºp cÃ¡c tráº£ lá»i Ä‘Æ°á»£c cÃ¡c cÃ¢u há»i <strong>táº¡i sao</strong> vá» cÃ¡c lá»—i huáº¥n luyá»‡n. Sau khi Ä‘Ã£ Ä‘á»c vÃ  náº¯m vá»¯ng kiáº¿n thá»©c á»Ÿ bÃ i 25, chá»‰ cáº§n lÃ m theo tuáº§n tá»± cÃ¡c bÆ°á»›c bÃªn dÆ°á»›i lÃ  báº¡n sáº½ thu Ä‘Æ°á»£c thÃ nh quáº£.</p>

<h1 id="2-cÃ i-Ä‘áº·t-cáº¥u-hÃ¬nh-cudnn">2. CÃ i Ä‘áº·t cáº¥u hÃ¬nh cuDNN</h1>

<p>CUDA Deep Neural Network library (cuDNN) lÃ  má»™t thÆ° viá»‡n giÃºp tÄƒng tá»‘c GPU khi huáº¥n luyá»‡n cÃ¡c model deep learning. ThÆ° viá»‡n nÃ y cung cáº¥p quÃ¡ trÃ¬nh tá»‘i Æ°u huáº¥n luyá»‡n feed forward vÃ  backpropagation trÃªn cÃ¡c layers: convolution, pooling, normalization, activation. ÄÃ¢y lÃ  má»™t thÆ° viá»‡n ráº¥t máº¡nh vÃ  Ä‘Æ°á»£c há»— trá»£ trÃªn Ä‘a dáº¡ng cÃ¡c deep learning frameworks nhÆ°:  Caffe,Caffe2, Chainer, Keras,MATLAB, MxNet, TensorFlow, vÃ  PyTorch.</p>

<p>ChÃºng ta nÃªn sá»­ dá»¥ng cÃ¡c thÆ° viá»‡n cuDNN má»›i nháº¥t vÃ¬ theo nhÆ° khuyáº¿n cÃ¡o cá»§a NVIDIA, nÃ³ cÃ³ thá»ƒ tÄƒng tá»‘c nhiá»u láº§n so vá»›i version cÅ©.</p>

<p><img src="https://developer.nvidia.com/sites/default/files/rnn-image_0.png" class="normalpic" /></p>

<p>Äá»‘i vá»›i cÃ¡c báº¡n sá»­ dá»¥ng mÃ¡y tÃ­nh cÃ¡ nhÃ¢n Ä‘Ã£ cÃ³ GPU, Ä‘á»ƒ sá»­ dá»¥ng Ä‘Æ°á»£c GPU thÃ¬ chÃºng ta pháº£i cÃ i Ä‘áº·t cuDNN. Báº¡n xem thÃªm <a href="https://developer.nvidia.com/cudnn">hÆ°á»›ng dáº«n cÃ i Ä‘áº·t cuDNN - NDIVIA</a>.</p>

<p>CÃ¡c báº¡n thá»±c hÃ nh trÃªn google colab cÃ³ thá»ƒ bá» qua pháº§n nÃ y vÃ¬ google colab Ä‘Ã£ sáºµn cÃ³ cuDNN.</p>

<h1 id="3-khá»Ÿi-táº¡o-google-colab">3. Khá»Ÿi táº¡o google colab</h1>

<h2 id="31-google-colab">3.1. Google colab</h2>

<p><strong>Táº¡i sao láº¡i lÃ  google colab?</strong></p>

<ul>
  <li>
    <p>Huáº¥n luyá»‡n model deep learning cáº§n tÃ i nguyÃªn khÃ¡ lá»›n. Äá»‘i vá»›i má»™t quá»‘c gia nghÃ¨o nhÆ° Viá»‡t Nam thÃ¬ tÃ´i khÃ´ng cho ráº±ng viá»‡c má»™t sinh viÃªn bá» ra vÃ i nghÃ¬n $ mua GPU Ä‘á»ƒ láº¯p vÃ o Laptop lÃ  há»£p lÃ½. TrÃ¡i láº¡i, ráº¥t lÃ£ng phÃ­ vÃ  khÃ´ng hiá»‡u quáº£.</p>
  </li>
  <li>
    <p>Google colab lÃ  má»™t virtual cloud machine Ä‘Æ°á»£c google cung cáº¥p miá»…n phÃ­ cho cÃ¡c nhÃ  nghiÃªn cá»©u. ÄÃ¢y lÃ  mÃ´i trÆ°á»ng lÃ½ tÆ°á»Ÿng Ä‘á»ƒ phÃ¡t triá»ƒn cÃ¡c mÃ´ hÃ¬nh vá»«a vÃ  nhá». Äiá»ƒm tuyá»‡t vá»i á»Ÿ google colab Ä‘Ã³ lÃ  mÃ´i trÆ°á»ng cá»§a nÃ³ Ä‘Ã£ cÃ i sáºµn cÃ¡c packages machine learning vÃ  frame works deep learning thÃ´ng dá»¥ng nháº¥t.</p>
  </li>
  <li>
    <p>Viá»‡c cÃ i cÃ¡c frame work deep learning trÃªn mÃ¡y cÃ¡ nhÃ¢n Ä‘Ã´i khi khÃ¡ tá»‘n thá»i gian vÃ¬ cÃ¡c lá»—i xung Ä‘á»™t package, xung Ä‘á»™t há»‡ Ä‘iá»u hÃ nh. CÃ¡c báº¡n cÃ³ thá»ƒ máº¥t vÃ i ngÃ y Ä‘á»ƒ sá»­a cÃ¡c lá»—i cáº¥u hÃ¬nh trÃªn mÃ¡y. Trong khi sá»­ dá»¥ng google colab lÃ  dÃ¹ng Ä‘Æ°á»£c ngay.</p>
  </li>
  <li>
    <p>Cáº¥u hÃ¬nh RAM vÃ  GPU cá»§a cÃ¡c báº¡n chÆ°a cháº¯c Ä‘Ã£ tá»‘t nhÆ° google. Theo Æ°á»›c tÃ­nh cá»§a tÃ´i, báº¡n cáº§n 100 triá»‡u Ä‘á»ƒ xÃ¢y má»™t cáº¥u hÃ¬nh mÃ¡y tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i google colab.</p>
  </li>
  <li>
    <p>Viá»‡c sá»­ dá»¥ng GPU trÃªn cáº¥u hÃ¬nh RAM, chip yáº¿u cÃ³ thá»ƒ khiáº¿n laptop cá»§a báº¡n nhanh bá»‹ há»ng.</p>
  </li>
  <li>
    <p>Vá»›i google colab, báº¡n cÃ³ thá»ƒ dá»… dÃ ng lÃ m viá»‡c vá»›i data Ä‘Æ°á»£c chia sáº» trÃªn google drive tá»« ngÆ°á»i khÃ¡c.</p>
  </li>
</ul>

<p>BÃªn cáº¡nh sá»­ dá»¥ng google colab thÃ¬ báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng má»™t sá»‘ virtual cloud mÃ  tÃ´i nghÄ© cÅ©ng ráº¥t hay Ä‘Ã³ lÃ :</p>

<ul>
  <li>
    <p><a href="https://www.kaggle.com/getting-started/78482">kaggle kernel</a>. Kaggle kernel cÃ³ má»™t kho tÃ i nguyÃªn vÃ´ háº¡n vá» dá»¯ liá»‡u vÃ  jupyter notebook practice tá»« cÃ¡c data scientist master. Äá»“ng thá»i kaggle kernel há»— trá»£ cáº£ ngÃ´n ngá»¯ R ráº¥t phÃ¹ há»£p vá»›i ngÆ°á»i lÃ m tÃ i chÃ­nh, thá»‘ng kÃª.</p>
  </li>
  <li>
    <p><a href="https://notebooks.azure.com/help/jupyter-notebooks">jupyter notebook- azure</a>. TÃ´i chá»‰ nghe qua, cÅ©ng chÆ°a sá»­ dá»¥ng.</p>
  </li>
</ul>

<p>Quay trá»Ÿ láº¡i thá»±c hÃ nh, táº¡i bÆ°á»›c nÃ y cáº§n táº¡o má»™t google colab. CÃ¡c báº¡n vÃ o google drive, sau Ä‘Ã³ click vÃ o <code class="highlighter-rouge">New &gt; More &gt; Google colab</code>.</p>

<p><img src="https://imgur.com/Xl4qJ0X.png" class="normalpic" /></p>

<p>Má»™t mÃ n hÃ¬nh google colab hiá»‡n ra, cÃ³ chá»©c nÄƒng gáº§n giá»‘ng nhÆ° jupyter notebook:</p>

<ul>
  <li>ChÃºng ta vá»«a cÃ³ thá»ƒ trÃ¬nh bÃ y vÄƒn báº£n káº¿t há»£p vá»›i xá»­ lÃ½ cÃ¢u lá»‡nh. CÃ¡c pháº§n trÃ¬nh bÃ y vÄƒn báº£n Ä‘Æ°á»£c táº¡o ra tá»« cÃ¡c block text vÃ  xá»­ lÃ½ code Ä‘Æ°á»£c táº¡o ra tá»« cÃ¡c block codes.</li>
</ul>

<p><img src="https://imgur.com/un5hQdr.png" class="normalpic" /></p>

<ul>
  <li>NgÃ´n ngá»¯ thá»±c thi máº·c Ä‘á»‹nh cá»§a Google colab lÃ  python. NgoÃ i ra báº¡n cÃ³ thá»ƒ thá»±c thi cÃ¡c lá»‡nh command line báº±ng cÃ¡ch thÃªm má»™t markup lÃ  dáº¥u <code class="highlighter-rouge">!</code> á»Ÿ Ä‘áº§u cÃ¢u lá»‡nh.</li>
</ul>

<p>Cháº³ng háº¡n bÃªn dÆ°á»›i tÃ´i sáº½ cháº¡y má»™t vÃ i lá»‡nh trÃªn commandline cá»§a ubuntu Ä‘á»ƒ kiá»ƒm tra version cuda Ä‘Æ°á»£c google cÃ i Ä‘áº·t.</p>

<p><strong>Command line kiá»ƒm tra version cuda:</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>!nvcc --version
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>nvcc: NVIDIA (R) Cuda compiler driver
Copyright (c) 2005-2018 NVIDIA Corporation
Built on Sat_Aug_25_21:08:01_CDT_2018
Cuda compilation tools, release 10.0, V10.0.130
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="32-enable-gpu-trÃªn-google-colab">3.2. Enable GPU trÃªn google colab</h2>

<p>Máº·c Ä‘á»‹nh google colab sáº½ disable GPU Ä‘á»ƒ tiáº¿t kiá»‡m tÃ i nguyÃªn. Do Ä‘Ã³ chÃºng ta enable báº±ng cÃ¡ch: TrÃªn thanh cÃ´ng cá»¥ cá»§a google colab click vÃ o <code class="highlighter-rouge">Runtime &gt; change runtime type</code>.</p>

<p><img src="https://imgur.com/rtwkCPw.png" width="750px" class="normalpic" /></p>

<p>Táº¡i cá»­a sá»• pop-up má»¥c <code class="highlighter-rouge">Hardware accelerator</code> ta lá»±a chá»n GPU vÃ  save.</p>

<p><img src="https://imgur.com/tj8SauX.png" width="750px" class="normalpic" /></p>

<p>Muá»‘n biáº¿t GPU Ä‘Ã£ enable thÃ nh cÃ´ng chÆ°a, ta sá»­ dá»¥ng:</p>

<p><strong>Command line kiá»ƒm tra cáº¥u hÃ¬nh GPU</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>!nvidia-smi
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://imgur.com/rAiiJoU.png" class="medianpic" /></p>

<p>NhÆ° váº­y google colab cung cáº¥p 1 GPU Tesla P4 vá»›i bá»™ nhá»› 7611MiB. ÄÃ¢y lÃ  GPU khÃ´ng quÃ¡ máº¡nh nhÆ°ng Ä‘á»§ Ä‘á»ƒ huáº¥n luyá»‡n cÃ¡c model deep learning vá»«a vÃ  nhá». PhÃ¹ há»£p vá»›i cÃ¡c báº¡n sinh viÃªn vÃ  cÃ¡c nhÃ  data scientist nghÃ¨o nhÆ° mÃ¬nh cháº³ng háº¡n.</p>

<h2 id="33-mount-google-drive">3.3. Mount google drive</h2>

<p>Google colab cÃ³ tÃ¡c dá»¥ng nhÆ° lÃ  má»™t VM (virtual machine computing) lÃ m nhiá»‡m vá»¥ tÃ­nh toÃ¡n, xá»­ lÃ½ dá»¯ liá»‡u. Google Drive lÃ  nÆ¡i lÆ°u trá»¯ dá»¯ liá»‡u. Do Ä‘Ã³ Ä‘á»ƒ VM truy cáº­p Ä‘Æ°á»£c tá»›i dá»¯ liá»‡u táº¡i Google drive thÃ¬ ta cáº§n mount drive.</p>

<p><img src="https://imgur.com/kpeMAsi.png" class="normalpic" /></p>

<p><strong>CÃ¢u lá»‡nh mount google drive:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>

<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s">'/content/gdrive'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>Go to this URL in a browser: https://accounts.google.com...

Enter your authorization code:
Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·
Mounted at /content/gdrive
</pre></td></tr></tbody></table></code></pre></div></div>

<p>DÃ²ng <code class="highlighter-rouge">Enter your authorization code:</code>: YÃªu cáº§u chÃºng ta nháº­p token Ä‘á»ƒ Ä‘Äƒng nháº­p vÃ o VM.</p>

<p>Click vÃ o link <code class="highlighter-rouge">Go to this URL in a browser</code> Ä‘á»ƒ xÃ¡c thá»±c email. Sau khi accept cÃ¡c bÆ°á»›c ta thu Ä‘Æ°á»£c Ä‘oáº¡n mÃ£ token bÃªn dÆ°á»›i:</p>

<p><img src="https://imgur.com/CQEv7NW.png" class="normalpic" /></p>

<p>Copy token vÃ  paste vÃ o dÃ²ng <code class="highlighter-rouge">Enter your authorization code:</code>. Sau bÆ°á»›c nÃ y chÃºng ta Ä‘Ã£ establish má»™t connection tá»« VM Ä‘áº¿n Google drive.</p>

<h1 id="4-huáº¥n-luyá»‡n-yolo-trÃªn-google-colab">4. Huáº¥n luyá»‡n YOLO trÃªn google colab</h1>

<h2 id="41-khá»Ÿi-táº¡o-project-darknet-trÃªn-google-drive">4.1. Khá»Ÿi táº¡o project darknet trÃªn google drive.</h2>

<p><a href="https://github.com/AlexeyAB/darknet">Darknet</a> lÃ  má»™t framework open source chuyÃªn biá»‡t vá» object detection Ä‘Æ°á»£c viáº¿t báº±ng ngÃ´n ngá»¯ C vÃ  CUDA. CÃ¡c mÃ´ hÃ¬nh Ä‘Æ°á»£c huáº¥n luyá»‡n trÃªn darknet nhanh, Ä‘á»“ng thá»i darknet dá»… cÃ i Ä‘áº·t vÃ  há»— trá»£ tÃ­nh toÃ¡n CPU vÃ  GPU. Cá»™ng Ä‘á»“ng sá»­ dá»¥ng darknet Ä‘Ã´ng Ä‘áº£o, Ä‘á»™i ngÅ© support nhiá»‡t tÃ¬nh. ÄÃ³ lÃ  lÃ½ do tÃ´i lá»±a chá»n darknet Ä‘á»ƒ hÆ°á»›ng dáº«n cÃ¡c báº¡n.</p>

<p>Táº¡i bÆ°á»›c nÃ y chÃºng ta cáº§n clone project <a href="https://github.com/phamdinhkhanh/darknetGoogleColab.git">darknetGoogleColab</a> mÃ  tÃ´i Ä‘Ã£ customize láº¡i má»™t chÃºt cho phÃ¹ há»£p vá»›i google colab.</p>

<p>CÃ¡c báº¡n thá»±c hiá»‡n tuáº§n tá»± nhÆ° sau:</p>

<p><strong>Step 1</strong>: Thay Ä‘á»•i Ä‘Æ°á»ng dáº«n tá»›i folder máº·c Ä‘á»‹nh lÃ  <code class="highlighter-rouge">My Drive</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>import os

path = "/content/gdrive/My Drive"
os.chdir(path)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Step 2:</strong> Sá»­ dá»¥ng command line Ä‘á»ƒ clone git project <code class="highlighter-rouge">darknetTurtorial</code> tá»« github repo cá»§a tÃ´i.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>!git clone https://github.com/phamdinhkhanh/darknetGoogleColab.git
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>Cloning into 'darknetGoogleColab'...
remote: Enumerating objects: 430, done.[K
remote: Counting objects: 100% (430/430), done.[K
remote: Compressing objects: 100% (321/321), done.[K
remote: Total 430 (delta 102), reused 430 (delta 102), pack-reused 0[K
Receiving objects: 100% (430/430), 6.20 MiB | 10.37 MiB/s, done.
Resolving deltas: 100% (102/102), done.
Checking out files: 100% (473/473), done.
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Sau khi cháº¡y thÃ nh cÃ´ng báº¡n kiá»ƒm tra trÃªn My Drive cá»§a Google drive báº¡n sáº½ tháº¥y folder <code class="highlighter-rouge">darknetGoogleColab</code> vá»«a má»›i Ä‘Æ°á»£c clone vá».</p>

<p><img src="https://imgur.com/AyeE1q0.png" class="largepic" /></p>

<p>Sau Ä‘Ã³ chÃºng ta cd vÃ o folder vÃ  phÃ¢n quyá»n execute module darknet Ä‘á»ƒ cÃ³ thá»ƒ cháº¡y Ä‘Æ°á»£c cÃ¡c lá»‡nh trÃªn darknet.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>%cd darknetGoogleColab

!ls

# phÃ¢n quyá»n execute module darknet
!chmod +x ./darknet
</pre></td></tr></tbody></table></code></pre></div></div>

<p>LÃºc nÃ y chÃºng ta Ä‘Ã£ cÃ³ thá»ƒ sá»­ dá»¥ng Ä‘Æ°á»£c cÃ¡c lá»‡nh cá»§a dá»± bÃ¡o, huáº¥n luyá»‡n cá»§a darknet trÃªn há»‡ Ä‘iá»u hÃ nh ubuntu.</p>

<h2 id="42-chuáº©n-bá»‹-dá»¯-liá»‡u">4.2. Chuáº©n bá»‹ dá»¯ liá»‡u</h2>

<h3 id="421-tool-bounding-box">4.2.1. Tool bounding box</h3>

<p>Hiá»‡n táº¡i cÃ³ ráº¥t nhiá»u cÃ¡c open source bounding box tool khÃ¡c nhau Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ gÃ¡n nhÃ£n cho mÃ´ hÃ¬nh YOLO. Vá»›i kinh nghiá»‡m tráº£i nghiá»‡m cÃ¡c tool nÃ y, tÃ´i khuyáº¿n nghá»‹ cÃ¡c báº¡n sá»­ dá»¥ng <a href="https://pypi.org/project/labelImg/">labelImg</a> cá»§a pypi vÃ¬ nhá»¯ng lÃ½ do sau:</p>

<p><img src="https://raw.githubusercontent.com/phamdinhkhanh/BBox-Tool/master/labelImage.jpg" class="largepic" /></p>

<ul>
  <li>Giao diá»‡n UI/UX khÃ¡ tá»‘t vá»›i Ä‘áº§y Ä‘á»§ chá»©c nÄƒng: open, load, save,â€¦.</li>
  <li>Há»— trá»£ gÃ¡n nhÃ£n trÃªn cáº£ 2 Ä‘á»‹nh dáº¡ng COCO xml format vÃ  YOLO default txt format.</li>
  <li>Chá»©c nÄƒng default bounding box cho phÃ©p tá»± Ä‘á»™ng gÃ¡n nhÃ£n cho cÃ¡c bá»©c áº£nh náº±m chung trong má»™t folder. VÃ­ dá»¥: Khi gÃ¡n nhÃ£n cho sáº£n pháº©m cafe thÃ¬ cÃ¡c bá»©c áº£nh cá»§a tÃ´i vá» cafe Ä‘á»u Ä‘Æ°á»£c xáº¿p vá» chung 1 folder. TÃ´i khÃ´ng cáº§n pháº£i gÃµ láº¡i nhÃ£n mÃ  chá»‰ cáº§n táº¡o má»™t default bounding box cho toÃ n bá»™ áº£nh.</li>
</ul>

<p>VÃ  ráº¥t nhiá»u cÃ¡c chá»©c nÄƒng khÃ¡c.</p>

<p>Viá»‡c cÃ i Ä‘áº·t vÃ  hÆ°á»›ng dáº«n sá»­ dá»¥ng cÃ¡c báº¡n Ä‘á»c táº¡i <a href="https://pypi.org/project/labelImg/">labelImg</a>.</p>

<p>Khi huáº¥n luyá»‡n model YOLO trÃªn darknet chÃºng ta sáº½ cáº§n sá»­ dá»¥ng Ä‘áº§u vÃ o lÃ  cÃ¡c bá»©c áº£nh (cÃ³ thá»ƒ lÃ  má»™t trong cÃ¡c Ä‘á»‹nh dáº¡ng png, jpg, jpeg) vÃ  annotation cá»§a chÃºng (Ä‘á»‹nh dáº¡ng txt). BÃªn dÆ°á»›i lÃ  ná»™i dung cá»§a má»™t file annotation.txt.</p>

<p><img src="https://imgur.com/66Lvm3R.png" class="normalpic" /></p>

<p>Ná»™i dung cá»§a file annotation sáº½ bao gá»“m:</p>

<p><code class="highlighter-rouge">&lt;id-class&gt; &lt;center-x&gt; &lt;center-y&gt; &lt;bbox-width&gt; &lt;bbox-height&gt;</code></p>

<p>Trong Ä‘Ã³: cÃ¡c giÃ¡ trá»‹ <code class="highlighter-rouge">&lt;center-x&gt; &lt;center-y&gt; &lt;bbox-width&gt; &lt;bbox-height&gt;</code> lÃ  tÃ¢m vÃ  kÃ­ch thÆ°á»›c width, height cá»§a bounding box Ä‘Ã£ Ä‘Æ°á»£c chuáº©n hÃ³a báº±ng cÃ¡ch chia cho width vÃ  height cá»§a áº£nh, do Ä‘Ã³ cÃ¡c giÃ¡ trá»‹ ngÃ y luÃ´n náº±m trong khoáº£ng [0, 1]. <code class="highlighter-rouge">&lt;id-class&gt;</code> lÃ  giÃ¡ trá»‹ index Ä‘Ã¡nh dáº¥u cÃ¡c classes.</p>

<p>Trong trÆ°á»ng há»£p má»™t áº£nh cÃ³ nhiá»u bounding box thÃ¬ file annotation sáº½ gá»“m nhiá»u dÃ²ng, má»—i má»™t bounding box lÃ  má»™t dÃ²ng.</p>

<p>Cáº£c áº£nh vÃ  annotation pháº£i Ä‘Æ°á»£c Ä‘á»ƒ chung trong cÃ¹ng 1 folder. Báº¡n Ä‘á»c cÃ³ thá»ƒ tham kháº£o qua dá»¯ liá»‡u máº«u <a href="https://github.com/phamdinhkhanh/VinIDProductObjectDetection/tree/master/img">Dá»¯ liá»‡u áº£nh sáº£n pháº©m TMDT</a>.</p>

<h3 id="422-dá»¯-liá»‡u-thá»±c-hÃ nh">4.2.2. Dá»¯ liá»‡u thá»±c hÃ nh</h3>

<p>Trong hÆ°á»›ng dáº«n nÃ y chÃºng ta cÃ¹ng xÃ¢y dá»±ng má»™t mÃ´ hÃ¬nh nháº­n diá»‡n sáº£n pháº©m thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­ gá»“m 5 nhÃ³m máº·t hÃ ng: <code class="highlighter-rouge">bia, cafe, mytom, nuoctuong, sua</code>. Äá»ƒ khÃ´ng máº¥t thá»i gian cho khÃ¢u chuáº©n bá»‹ dá»¯ liá»‡u thÃ¬ cÃ¡c báº¡n cÃ³ thá»ƒ clone dá»¯ liá»‡u tá»« git repo cá»§a tÃ´i:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>!git clone https://github.com/phamdinhkhanh/VinIDProductObjectDetection.git traindata
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>Cloning into 'data'...
remote: Enumerating objects: 325, done.[K
remote: Counting objects: 100% (325/325), done.[K
remote: Compressing objects: 100% (139/139), done.[K
remote: Total 325 (delta 2), reused 324 (delta 1), pack-reused 0[K
Receiving objects: 100% (325/325), 12.15 MiB | 15.99 MiB/s, done.
Resolving deltas: 100% (2/2), done.
Checking out files: 100% (216/216), done.
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Lá»‡nh trÃªn sáº½ clone dá»¯ liá»‡u vá» folder <code class="highlighter-rouge">traindata</code> trong project cá»§a chÃºng ta.</p>

<p>LÆ°u Ã½: KhÃ´ng Ä‘Æ°á»£c Ä‘áº·t tÃªn folder <code class="highlighter-rouge">traindata</code> trÃ¹ng vá»›i folder <code class="highlighter-rouge">data</code> máº·c Ä‘á»‹nh cá»§a darknet. Náº¿u khÃ´ng sáº½ xáº£y ra lá»—i <code class="highlighter-rouge">Cannot load image</code> khi dá»± bÃ¡o vÃ  nhÃ£n dá»± bÃ¡o cá»§a hÃ¬nh áº£nh khÃ´ng hiá»ƒn thá»‹.</p>

<p>Dá»¯ liá»‡u trong folder img sáº½ bao gá»“m cÃ¡c file áº£nh vÃ  file annotation (cÃ³ Ä‘uÃ´i .txt) cá»§a chÃºng.</p>

<p><img src="https://imgur.com/m477lgr.png" class="normalpic" /></p>

<p>file áº£nh vÃ  annotation pháº£i cÃ¹ng tÃªn Ä‘á»ƒ darknet cÃ³ thá»ƒ matching chÃºng trong quÃ¡ trÃ¬nh huáº¥n luyá»‡n.</p>

<h3 id="423-phÃ¢n-chia-dá»¯-liá»‡u-trainvalidation">4.2.3. PhÃ¢n chia dá»¯ liá»‡u train/validation</h3>

<p>á» bÆ°á»›c nÃ y ta sáº½ táº¡o ra 2 file train.txt vÃ  valid.txt chá»©a dá»¯ liá»‡u Ä‘Æ°á»ng dáº«n tá»›i cÃ¡c file hÃ¬nh áº£nh náº±m trong táº­p train vÃ  validation. ChÃºng ta sáº½ sá»­ dá»¥ng Ä‘oáº¡n code bÃªn dÆ°á»›i Ä‘á»ƒ lá»±a chá»n ra ngáº«u nhiÃªn 20 files lÃ m dá»¯ liá»‡u validation vÃ  cÃ¡c files cÃ²n láº¡i lÃ m dá»¯ liá»‡u train.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre>import glob2
import numpy as np

all_files = []
for ext in ["*.png", "*.jpeg", "*.jpg"]:
  images = glob2.glob(os.path.join("traindata/img/", ext))
  all_files += images

rand_idx = np.random.randint(0, len(all_files), 20)

# Create train.txt
with open("train.txt", "w") as f:
  for idx in np.arange(len(all_files)):
    # if idx not in rand_idx:
    f.write(all_files[idx]+'\n')

# Create valid.txt
with open("valid.txt", "w") as f:
  for idx in np.arange(len(all_files)):
    if idx in rand_idx:
      f.write(all_files[idx]+'\n')
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="43-cáº¥u-hÃ¬nh-darknet">4.3. Cáº¥u hÃ¬nh darknet</h2>

<h3 id="431-táº¡o-file-object-name">4.3.1. Táº¡o file object name</h3>

<p>ÄÃ¢y lÃ  files chá»©a tÃªn cÃ¡c classes mÃ  chÃºng ta sáº½ huáº¥n luyá»‡n mÃ´ hÃ¬nh. TrÃªn file nÃ y, thá»© tá»± cÃ¡c classes name cáº§n pháº£i Ä‘áº·t Ä‘Ãºng vá»›i index cá»§a nÃ³ trong cÃ¡c file label cá»§a váº­t thá»ƒ.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre># Create obj.names config file
!echo bia &gt; obj.names
!echo cafe &gt;&gt; obj.names
!echo mytom &gt;&gt; obj.names
!echo nuoctuong &gt;&gt; obj.names
!echo sua &gt;&gt; obj.names
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Äoáº¡n code trÃªn sá»­ dá»¥ng lá»‡nh <code class="highlighter-rouge">echo</code> cá»§a <code class="highlighter-rouge">bash</code> Ä‘á»ƒ táº¡o vÃ  write ná»™i dung vÃ o file <code class="highlighter-rouge">obj.names</code>. Sau Ä‘Ã³, má»™t file <code class="highlighter-rouge">obj.names</code> Ä‘Æ°á»£c táº¡o thÃ nh trong project foler. Báº¡n cÃ³ thá»ƒ má»Ÿ file nÃ y ra Ä‘á»ƒ kiá»ƒm tra ná»™i dung.</p>

<h3 id="432-táº¡o-file-config-data">4.3.2. Táº¡o file config data</h3>

<p>File config data sáº½ khai bÃ¡o má»™t sá»‘ thÃ´ng tin nhÆ°:</p>

<ul>
  <li>Sá»‘ lÆ°á»£ng classes</li>
  <li>ÄÆ°á»ng dáº«n tá»›i cÃ¡c file train.txt, test.txt</li>
  <li>ÄÆ°á»ng dáº«n tá»›i file obj.names</li>
  <li>ThÆ° má»¥c backup mÃ´ hÃ¬nh huáº¥n luyá»‡n.</li>
</ul>

<p>Cháº¡y lá»‡nh bÃªn dÆ°á»›i Ä‘á»ƒ táº¡o file nÃ y.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre># Config obj.data config file
!echo classes=5 &gt; obj.data
!echo train=train.txt &gt;&gt; obj.data
!echo valid=test.txt &gt;&gt; obj.data
!echo names=obj.names &gt;&gt; obj.data
!echo backup=backup &gt;&gt; obj.data
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="433-táº¡o-file-config-model">4.3.3. Táº¡o file config model</h3>

<p>ÄÃ¢y lÃ  bÆ°á»›c quan trá»ng nháº¥t khi huáº¥n luyá»‡n model YOLO. ChÃºng ta sáº½ sá»­ dá»¥ng file <a href="https://github.com/pjreddie/darknet/blob/master/cfg/yolov3.cfg">yolov3.cfg</a> Ä‘á»ƒ cáº¥u hÃ¬nh mÃ´ hÃ¬nh huáº¥n luyá»‡n. CÃ¡c báº¡n download file trÃªn vá» mÃ¡y vÃ  Ä‘iá»u chá»‰nh cÃ¡c dÃ²ng:</p>

<ul>
  <li>
    <p>Táº¡i cÃ¡c dÃ²ng 610, 696, 783: Thay <code class="highlighter-rouge">classes=80</code> thÃ nh <code class="highlighter-rouge">classes=5</code> lÃ  sá»‘ lÆ°á»£ng classes chÃºng ta huáº¥n luyá»‡n.</p>
  </li>
  <li>
    <p>Táº¡i cÃ¡c dÃ²ng 603, 689, 776: Thay sá»‘ lÆ°á»£ng <code class="highlighter-rouge">filters=255</code> vá» <code class="highlighter-rouge">filter=30</code>. ÄÃ¢y chÃ­nh lÃ  layer cuá»‘i cÃ¹ng cá»§a base network. Do Ä‘Ã³ chÃºng cÃ³ output shape thay Ä‘á»•i theo sá»‘ lÆ°á»£ng classes theo Ä‘Ãºng cÃ´ng thá»©c cá»§a bÃ i trÆ°á»›c Ä‘Ã³ lÃ : <code class="highlighter-rouge">(n_classes + 5)x3 = (5+5)x3 = 30</code>.</p>
  </li>
  <li>
    <p>max_batches: táº¡i dÃ²ng 20 lÃ  sá»‘ lÆ°á»£ng steps tá»‘i Ä‘a Ä‘á»ƒ huáº¥n luyá»‡n models YOLO. Äá»‘i vá»›i dá»¯ liá»‡u 5 classes chá»‰ cáº§n Ä‘iá»u chá»‰nh <code class="highlighter-rouge">max_batches=5000</code> lÃ  cÃ³ thá»ƒ cÃ³ nghiá»‡m tá»‘t.</p>
  </li>
  <li>
    <p>burn_in: Táº¡i dÃ²ng 19 lÃ  sá»‘ lÆ°á»£ng steps ban Ä‘áº§u Ä‘Æ°á»£c giá»¯ sao cho learning_rate ráº¥t bÃ©. GiÃ¡ trá»‹ nÃ y sáº½ tÄƒng dáº§n tá»« 0 Ä‘áº¿n learning_rate. Sau Ä‘Ã³ learning_rate sáº½ Ä‘Æ°á»£c giá»¯ á»•n Ä‘á»‹nh. Thá»±c nghiá»‡m cho tháº¥y thiáº¿t láº­p learning_rate bÃ© á»Ÿ nhá»¯ng steps Ä‘áº§u sáº½ giÃºp cho thuáº­t toÃ¡n há»™i tá»¥ nhanh hÆ¡n. Do sá»‘ lÆ°á»£ng <code class="highlighter-rouge">max_batches</code> chá»‰ lÃ  5000 nÃªn cáº§n Ä‘iá»u chá»‰nh giáº£m <code class="highlighter-rouge">burn_in = 100</code>.</p>
  </li>
  <li>
    <p>steps: Táº¡i dÃ²ng 22. Äiá»u chá»‰nh vá» <code class="highlighter-rouge">steps=4000,4500</code>. ÄÃ¢y lÃ  cÃ¡c vá»‹ trÃ­ step mÃ  chÃºng ta sáº½ báº¯t Ä‘áº§u giáº£m dáº§n learning_rate vÃ¬ thuáº­t toÃ¡n Ä‘Ã£ Ä‘áº¡t tá»›i Ä‘iá»ƒm há»™i tá»¥ nÃªn khÃ´ng cáº§n thiáº¿t láº­p learning_rate quÃ¡ cao.</p>
  </li>
</ul>

<p>Sau khi thá»±c hiá»‡n cÃ¡c thay Ä‘á»•i xong, cÃ¡c báº¡n save file láº¡i vÃ  push lÃªn project <code class="highlighter-rouge">darknetGoogleColab</code> cá»§a google driver.</p>

<p>TrÆ°á»›c Ä‘Ã³, hÃ£y Ä‘á»•i tÃªn láº¡i thÃ nh <code class="highlighter-rouge">yolov3-5c-5000-maxsteps.cfg</code>
Ä‘á»ƒ Ä‘Ã¡nh dáº¥u Ä‘Ã¢y lÃ  cáº¥u hÃ¬nh cho yolo version 3 vá»›i 5 classes vÃ  5000 bÆ°á»›c huáº¥n luyá»‡n.</p>

<p>CÃ¡c file config nÃ y Ä‘Ã£ cÃ³ sáºµn trong github repo cá»§a tÃ´i nÃªn báº¡n cÃ³ thá»ƒ download vá» sá»­ dá»¥ng ngay.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>os.path.exists("obj.data")
os.path.exists("yolov3-5c-5000-max-steps.cfg")
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>True
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="44-cÃ¡c-hÃ m-phá»¥-trá»£">4.4. CÃ¡c hÃ m phá»¥ trá»£</h2>

<p>Äá»ƒ thuáº­t lá»£i cho viá»‡c Ä‘á»c vÃ  ghi vÃ  hiá»ƒn thá»‹ hÃ¬nh áº£nh, tÃ´i sáº½ xÃ¢y dá»±ng cÃ¡c hÃ m phá»¥ trá»£ cÃ³ chá»©c nÄƒng nhÆ° sau:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">imShow()</code>: Hiá»ƒn thá»‹ hÃ¬nh áº£nh tá»« má»™t path.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">upload()</code>: Upload má»™t file tá»« local lÃªn google drive.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">download()</code>: Download má»™t file tá»« má»™t path trÃªn máº¡ng.</p>
  </li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre>#download files
def imShow(path):
  import cv2
  import matplotlib.pyplot as plt
  %matplotlib inline

  image = cv2.imread(path)
  height, width = image.shape[:2]
  resized_image = cv2.resize(image,(3*width, 3*height), interpolation = cv2.INTER_CUBIC)

  fig = plt.gcf()
  fig.set_size_inches(18, 10)
  plt.axis("off")
  #plt.rcParams['figure.figsize'] = [10, 5]
  plt.imshow(cv2.cvtColor(resized_image, cv2.COLOR_BGR2RGB))
  plt.show()
  
  
def upload():
  from google.colab import files
  uploaded = files.upload() 
  for name, data in uploaded.items():
    with open(name, 'wb') as f:
      f.write(data)
      print ('saved file', name)
      
def download(path):
  from google.colab import files
  files.download(path)
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="45-huáº¥n-luyá»‡n-mÃ´-hÃ¬nh">4.5. Huáº¥n luyá»‡n mÃ´ hÃ¬nh</h2>

<h3 id="451-download-pretrain-model">4.5.1. Download pretrain model</h3>

<p>YOLO Ä‘Æ°á»£c huáº¥n luyá»‡n trÃªn ráº¥t nhiá»u cÃ¡c model pretrain. Nhá»¯ng mÃ´ hÃ¬nh nÃ y Ä‘Æ°á»£c xÃ¢y dá»±ng trÃªn cÃ¡c bá»™ dá»¯ liá»‡u áº£nh máº«u lá»›n nhÆ°: <a href="http://cocodataset.org/#home">COCO</a>, <a href="http://host.robots.ox.ac.uk/pascal/VOC/">Pascal VOC</a>, <a href="http://image-net.org/download">Imagenet</a>, <a href="https://www.cs.toronto.edu/~kriz/cifar.html">CIFAR</a>.</p>

<p>ÄÃ¢y lÃ  nhá»¯ng bá»™ dá»¯ liá»‡u cÃ³ Ä‘á»‹nh dáº¡ng vÃ  format chuáº©n, Ä‘Æ°á»£c Ä‘áº£m báº£o bá»Ÿi cÃ¡c tá»• chá»©c vÃ  viá»‡n nghiÃªn cá»©u lá»›n trÃªn tháº¿ giá»›i nÃªn chÃºng ta hoÃ n toÃ n cÃ³ thá»ƒ yÃªn tÃ¢m vá» cháº¥t lÆ°á»£ng dá»¯ liá»‡u.</p>

<p>List cÃ¡c danh sÃ¡ch model pretrain cÃ¡c báº¡n cÃ³ thá»ƒ theo dÃµi táº¡i <a href="https://pjreddie.com/darknet/yolo/">Darknet YOLO</a></p>

<p><img src="https://imgur.com/xJ1d61d.png" class="normalpic" /></p>

<p>á» vÃ­ dá»¥ thá»±c hÃ nh nÃ y, chÃºng ta sáº½ sá»­ dá»¥ng pretrain model <a href="https://pjreddie.com/media/files/darknet53.conv.74">darknet53.conv.74</a> dÆ°á»£c huáº¥n luyá»‡n tá»« bá»™ dá»¯ liá»‡u ImageNet. TrÆ°á»›c tiÃªn hÃ£y clone file weight vá» google drive.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>!wget https://pjreddie.com/media/files/darknet53.conv.74
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>--2020-03-08 07:55:46--  https://pjreddie.com/media/files/darknet53.conv.74
Resolving pjreddie.com (pjreddie.com)... 128.208.4.108
Connecting to pjreddie.com (pjreddie.com)|128.208.4.108|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 162482580 (155M) [application/octet-stream]
Saving to: â€˜darknet53.conv.74â€™

darknet53.conv.74   100%[===================&gt;] 154.96M  1.11MB/s    in 1m 45s  

2020-03-08 07:57:32 (1.47 MB/s) - â€˜darknet53.conv.74â€™ saved [162482580/162482580]
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="452-backup-model">4.5.2. Backup model</h3>

<p>Táº¡o má»™t folder backup Ä‘á»ƒ lÆ°u káº¿t quáº£ huáº¥n luyá»‡n sau má»—i 1000 steps. Folder backup nÃ y pháº£i trÃ¹ng vá»›i tÃªn vá»›i link folder backup Ä‘Ã£ Ä‘Æ°á»£c khai bÃ¡o á»Ÿ step <code class="highlighter-rouge">4.3.3. táº¡o file config data</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>!mkdir backup
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Náº¿u Ä‘á»ƒ 1000 steps má»›i backup model cÃ³ thá»ƒ khÃ¡ lÃ¢u. Äá»ƒ trÃ¡nh cÃ¡c lá»—i phÃ¡t sinh khi huáº¥n luyá»‡n táº¡i 1000 steps Ä‘áº§u tiÃªn, trong project cá»§a mÃ¬nh tÃ´i Ä‘Ã£ Ä‘iá»u chá»‰nh sáºµn last model backup sau má»—i 100 steps.</p>

<h3 id="453-huáº¥n-luyá»‡n-model">4.5.3. Huáº¥n luyá»‡n model</h3>

<p>Äá»ƒ huáº¥n luyá»‡n model ta chá»‰ cáº§n thá»±c hiá»‡n lá»‡nh <code class="highlighter-rouge">detector train</code>.</p>

<p>Tá»•ng quÃ¡t cÃº phÃ¡p:</p>

<p><code class="highlighter-rouge">!./darknet detector train [data config file] [model config file] [pretrain-model weights] -dont_show &gt; [file log saved]</code></p>

<p>Trong Ä‘Ã³ cÃ¡c <code class="highlighter-rouge">[data config file]</code>, <code class="highlighter-rouge">[model config file]</code> lÃ  nhá»¯ng file config. <code class="highlighter-rouge">[pretrain-model weights]</code> lÃ  file model pretrain vÃ  <code class="highlighter-rouge">[file log saved]</code> lÃ  file log quÃ¡ trÃ¬nh training.</p>

<p>Note: Khi save log vÃ o <code class="highlighter-rouge">[file log saved]</code> thÃ¬ máº·c Ä‘á»‹nh mÃ´ hÃ¬nh cá»§a báº¡n sáº½ khÃ´ng hiá»ƒn thá»‹ log ra ngoÃ i mÃ n hÃ¬nh ná»¯a. Nhiá»u báº¡n Ä‘Ã£ hiá»ƒu láº§m ráº±ng mÃ´ hÃ¬nh ngá»«ng cháº¡y. Äá»ƒ hiá»ƒn thá»‹ log quÃ¡ trÃ¬nh huáº¥n luyá»‡n thÃ¬ báº¡n bá» <code class="highlighter-rouge">&gt; [file log saved]</code> á»Ÿ cuá»‘i cÃ¢u lá»‡nh.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>!./darknet detector train obj.data yolov3-5c-5000-max-steps.cfg darknet53.conv.74 -dont_show &gt; yolov3-5c.log
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre>layer     filters    size              input                output
   0 conv     32  3 x 3 / 1   608 x 608 x   3   -&gt;   608 x 608 x  32 0.639 BF
   1 conv     64  3 x 3 / 2   608 x 608 x  32   -&gt;   304 x 304 x  64 3.407 BF
   2 conv     32  1 x 1 / 1   304 x 304 x  64   -&gt;   304 x 304 x  32 0.379 BF
   3 conv     64  3 x 3 / 1   304 x 304 x  32   -&gt;   304 x 304 x  64 3.407 BF
   4 Shortcut Layer: 1
   ...
  94 yolo
  95 route  91
  96 conv    128  1 x 1 / 1    38 x  38 x 256   -&gt;    38 x  38 x 128 0.095 BF
  97 upsample            2x    38 x  38 x 128   -&gt;    76 x  76 x 128
  98 route  97 36
  99 conv    128  1 x 1 / 1    76 x  76 x 384   -&gt;    76 x  76 x 128 0.568 BF
 100 conv    256  3 x 3 / 1    76 x  76 x 128   -&gt;    76 x  76 x 256 3.407 BF
 101 conv    128  1 x 1 / 1    76 x  76 x 256   -&gt;    76 x  76 x 128 0.379 BF
 102 conv    256  3 x 3 / 1    76 x  76 x 128   -&gt;    76 x  76 x 256 3.407 BF
 103 conv    128  1 x 1 / 1    76 x  76 x 256   -&gt;    76 x  76 x 128 0.379 BF
 104 conv    256  3 x 3 / 1    76 x  76 x 128   -&gt;    76 x  76 x 256 3.407 BF
 105 conv     30  1 x 1 / 1    76 x  76 x 256   -&gt;    76 x  76 x  30 0.089 BF
 106 yolo
Total BFLOPS 139.527 
 Allocate additional workspace_size = 13.31 MB 
Loading weights from darknet53.conv.74...Done!
Saving weights to backup/yolov3-5c-5000-max-steps_last.weights
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Náº¿u báº¡n nÃ o gáº·p lá»—i:</p>

<p><code class="highlighter-rouge">CUDA Error: out of memory: File exists</code></p>

<p>HÃ£y quay trá»Ÿ láº¡i file <code class="highlighter-rouge">yolov3-5c-5000-max-steps.cfg</code> vÃ  Ä‘iá»u chá»‰nh tÄƒng <code class="highlighter-rouge">subdivisions=32</code>. Sau Ä‘Ã³ train láº¡i model tá»« Ä‘áº§u.</p>

<p>Tá»•ng cá»™ng quÃ¡ trÃ¬nh train háº¿t khoáº£ng <code class="highlighter-rouge">5h</code> Ä‘á»“ng há»“. Náº¿u báº¡n muá»‘n ngá»“i Ä‘á»£i thÃ nh quáº£, hÃ£y kiÃªn nháº«n chá» Ä‘á»£i. Hoáº·c náº¿u muá»‘n cÃ³ ngay thÃ nh quáº£, hÃ£y download file <a href="https://drive.google.com/drive/folders/1Oj7yOMEPG59BRVyA3QjVoHWyzX8lNW-E?usp=sharing">pretrain nháº­n diá»‡n sáº£n pháº©m TMDT cá»§a tÃ´i</a>.</p>

<p>Má»™t sá»‘ lÆ°u Ã½:</p>

<ul>
  <li>Log cá»§a chÆ°Æ¡ng trÃ¬nh sáº½ khÃ´ng hiá»‡n ra táº¡i mÃ n hÃ¬nh do chÃºng ta Ä‘Ã£ save vÃ o file <code class="highlighter-rouge">yolov3-5c.log</code>. Má»¥c Ä‘Ã­ch chÃ­nh lÃ  Ä‘á»ƒ lÆ°u láº¡i log nháº±m visualize loss function (xem má»¥c 4.5.4). Náº¿u báº¡n muá»‘n monitor ngay táº¡i mÃ n hÃ¬nh google colab thÃ¬ cháº¡y lá»‡nh:</li>
</ul>

<p><code class="highlighter-rouge">!./darknet detector train obj.data yolov3-5c-5000-max-steps.cfg darknet53.conv.74 -dont_show</code></p>

<p>Báº¡n cÃ³ thá»ƒ má»Ÿ má»™t google colab khÃ¡c Ä‘á»ƒ thá»±c hiá»‡n má»¥c <code class="highlighter-rouge">4.5.4 visualize loss function</code>.</p>

<ul>
  <li>
    <p>Äá»«ng quÃªn kiá»ƒm tra Ä‘Æ°á»ng truyá»n internet thÆ°á»ng xuyÃªn. Google Colab sáº½ tá»± Ä‘á»™ng kill cÃ¡c session offline trong vÃ²ng 1h. Tá»©c náº¿u báº¡n táº¯t colab hoáº·c bá»‹ disconnect internet thÃ¬ má»i thá»© váº«n tiáº¿p diá»…n trong 1h vÃ  sau Ä‘Ã³ luá»“ng training sáº½ bá»‹ kill.</p>
  </li>
  <li>
    <p>Google colab Ä‘á»“ng thá»i cho phÃ©p Ä‘á»™ dÃ i tá»‘i Ä‘a cá»§a má»™t session lÃ  12h. VÃ¬ váº­y vá»›i cÃ¡c bá»™ dá»¯ liá»‡u lá»›n thÃ¬ huáº¥n luyá»‡n mÃ´ hÃ¬nh object detection trÃªn google colab lÃ  má»™t viá»‡c báº¥t kháº£ thi.</p>
  </li>
</ul>

<h3 id="454-visualize-hÃ m-loss-function">4.5.4. Visualize hÃ m loss function</h3>

<p>Káº¿t quáº£ huáº¥n luyá»‡n cá»§a mÃ´ hÃ¬nh qua tá»«ng step sáº½ Ä‘Æ°á»£c lÆ°u vÃ o file <code class="highlighter-rouge">yolov3-5c.log</code>. ChÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng file nÃ y Ä‘á»ƒ visualize hÃ m loss function.</p>

<p>Trong git project Ä‘Æ°á»£c customize tá»« darknet tÃ´i Ä‘Ã£ code sáºµn má»™t file cÃ³ tÃ¡c dá»¥ng visualize loss function. Ã tÆ°á»Ÿng xá»­ lÃ½ khÃ´ng cÃ³ gÃ¬ khÃ³, chÃºng ta sáº½ tÃ¬m trong log cÃ¡c dÃ²ng cÃ³ <code class="highlighter-rouge">Average Loss</code> vÃ  trÃ­ch xuáº¥t giÃ¡ trá»‹ loss function vÃ  visualize. Báº¡n Ä‘á»c cÃ³ thá»ƒ má»Ÿ file ra nghiÃªn cá»©u.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>!python3 plotTrainLoss.py yolov3-5c.log
imShow('training_loss_plot.png')
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="/assets/images/20200310_YOLOGoogleColab/DarknetGoogleColab_50_0.png" class="normalpic" /></p>

<p>NhÆ° váº­y Ä‘á»“ thá»‹ loss function cho tháº¥y thuáº­t toÃ¡n Ä‘Ã£ há»™i tá»¥ sau khoáº£ng 100 batches Ä‘áº§u tiÃªn. Loss function á»Ÿ giai Ä‘oáº¡n sau cÃ³ xu hÆ°á»›ng tiá»‡m cáº­n 0. Äiá»u nÃ y chá»©ng tá» chiáº¿n lÆ°á»£c lá»±a chá»n learning_rate nhá» á»Ÿ 100 steps Ä‘áº§u tiÃªn Ä‘Ã£ phÃ¡t huy hiá»‡u quáº£ giÃºp thuáº­t toÃ¡n há»™i tá»¥ nhanh hÆ¡n.</p>

<h2 id="46-dá»±-bÃ¡o">4.6. Dá»± bÃ¡o</h2>

<p>Sau khi huáº¥n luyá»‡n xong mÃ´ hÃ¬nh, káº¿t quáº£ sau cÃ¹ng sáº½ Ä‘Æ°á»£c lÆ°u trong folder backup</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>!ls backup
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>yolov3-5c-5000-max-steps_last.weights
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Äá»ƒ dá»± bÃ¡o cho má»™t bá»©c áº£nh ta sá»­ dá»¥ng cÃº phÃ¡p:</p>

<p><code class="highlighter-rouge">!./darknet detector test [data config file] [model config file] [last-model weights] [image path] -dont_show</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>!./darknet detector test obj.data yolov3-5c-5000-max-steps-test.cfg backup/yolov3-5c-5000-max-steps_last.weights traindata/test/nuoctuong3.jpg -dont_show

imShow('predictions.jpg')
</pre></td></tr></tbody></table></code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>traindata/test/nuoctuong3.jpg: Predicted in 56.505000 milli-seconds.
nuoctuong: 34%
nuoctuong: 87%
nuoctuong: 96%
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="/assets/images/20200310_YOLOGoogleColab/DarknetGoogleColab_55_1.png" class="normalpic" /></p>

<p>Do google colab suppress cÃ¡c hÃ m graphic cá»§a opencv nÃªn ta khÃ´ng thá»ƒ show image trá»±c tiáº¿p mÃ  pháº£i save káº¿t quáº£ vÃ o file <code class="highlighter-rouge">predictions.jpg</code>.</p>

<p>argument <code class="highlighter-rouge">-dont_show</code> Ä‘á»ƒ by pass cÃ¡c lá»—i graphic cá»§a opencv.</p>

<p>NhÆ° váº­y chÃºng ta Ä‘Ã£ hoÃ n thÃ nh quÃ¡ trÃ¬nh huáº¥n luyá»‡n vÃ  dá»± bÃ¡o má»™t mÃ´ hÃ¬nh object detection trÃªn google colab. CÅ©ng khÃ´ng quÃ¡ khÃ³ khÄƒn pháº£i khÃ´ng nÃ o?</p>

<h1 id="5-Æ°á»›c-tÃ­nh-thá»i-gian-huáº¥n-luyá»‡n">5. Æ¯á»›c tÃ­nh thá»i gian huáº¥n luyá»‡n</h1>

<p>Khi hiá»ƒu ká»¹ vá» lÃ½ thuyáº¿t cá»§a mÃ´ hÃ¬nh YOLO cÃ¡c báº¡n sáº½ hiá»ƒu lÃ½ do táº¡i sao model YOLO láº¡i huáº¥n luyá»‡n lÃ¢u nhÆ° váº­y. Tá»« má»™t áº£nh Ä‘áº§u vÃ o kÃ­ch thÆ°á»›c <code class="highlighter-rouge">418x418</code>, YOLO sáº½ cáº§n dá»± Ä‘oÃ¡n nhÃ£n vÃ  tá»a Ä‘á»™ cá»§a tá»•ng cá»™ng <code class="highlighter-rouge">(13x13+26x26+52x52)x3 = 10647</code> bounding boxes. Giáº£ sá»­ má»—i má»™t batch cá»§a chÃºng ta cÃ³ kÃ­ch thÆ°á»›c 64 áº£nh vÃ  sá»‘ lÆ°á»£ng <code class="highlighter-rouge">max_batches = 5000</code>. NhÆ° váº­y chÃºng ta cáº§n dá»± bÃ¡o cho tá»•ng cá»™ng: <code class="highlighter-rouge">10647x5000x64 = 3.4 triá»‡u</code> bounding boxes. ÄÃ¢y lÃ  má»™t con sá»‘ khÃ´ng há» nhá» nÃªn quÃ¡ trÃ¬nh huáº¥n luyá»‡n trÃªn google colab sáº½ máº¥t tá»›i vÃ i h.</p>

<p>Google colab sáº½ chá»‰ cho phÃ©p báº¡n huáº¥n luyá»‡n trong 12h liÃªn tá»¥c. Do Ä‘Ã³, trÆ°á»›c khi huáº¥n luyá»‡n chÃºng ta cáº§n Æ°á»›c lÆ°á»£ng tá»•ng thá»i gian huáº¥n luyá»‡n Ä‘á»ƒ khÃ´ng vÆ°á»£t quÃ¡ giá»›i háº¡n time. TÃ´i sáº½ giá»›i thiá»‡u cÃ¡c báº¡n má»™t sá»‘ máº¹o Æ°á»›c tÃ­nh vÃ  tiáº¿t kiá»‡m thá»i gian huáº¥n luyá»‡n.</p>

<ul>
  <li>
    <p>NÃªn Æ°á»›c tÃ­nh tá»•ng thá»i gian huáº¥n luyá»‡n dá»±a trÃªn thá»i gian huáº¥n luyá»‡n cá»§a 1 batch. Náº¿u báº¡n huáº¥n luyá»‡n má»™t batch háº¿t 3.6s. NhÆ° váº­y 5000 batches sáº½ tiÃªu tá»‘n cá»§a báº¡n khoáº£ng: <code class="highlighter-rouge">(3.6x5000)/3600 = 5 h</code> huáº¥n luyá»‡n. Táº¥t nhiÃªn Ä‘Ã¢y chá»‰ lÃ  Æ°á»›c tÃ­nh tÆ°Æ¡ng Ä‘á»‘i vÃ¬ khÃ´ng pháº£i má»i batch Ä‘á»u Ä‘Æ°á»£c huáº¥n luyá»‡n vá»›i thá»i gian báº±ng nhau. Náº¿u gáº·p nhá»¯ng batch cÃ³ hÃ¬nh áº£nh lá»—i, format khÃ´ng tÆ°Æ¡ng thÃ­ch thÃ¬ cÃ³ thá»ƒ tá»‘n ráº¥t nhiá»u thá»i gian Ä‘á»ƒ chÆ°Æ¡ng trÃ¬nh gá»¡ lá»—i.</p>
  </li>
  <li>
    <p>HÃ£y save log trong quÃ¡ trÃ¬nh huáº¥n luyá»‡n vÃ  váº½ biá»ƒu Ä‘á»“ loss function. Biá»ƒu Ä‘á»“ loss function cho ta biáº¿t quÃ¡ trÃ¬nh huáº¥n luyá»‡n Ä‘Ã£ Ä‘i tá»›i tráº¡ng thÃ¡i há»™i tá»¥ hay chÆ°a? CÃ³ thá»ƒ dá»«ng sá»›m quÃ¡ trÃ¬nh huáº¥n luyá»‡n náº¿u báº¡n quan sÃ¡t tháº¥y loss function dÆ°á»ng nhÆ° Ä‘Ã£ há»™i tá»¥.</p>
  </li>
  <li>
    <p>Huáº¥n luyá»‡n trÃªn nhiá»u GPU song song (cÃ¡ch nÃ y chá»‰ Ã¡p dá»¥ng vá»›i cÃ¡c báº¡n sá»Ÿ há»¯u nhiá»u GPU, khÃ´ng Ã¡p dá»¥ng trÃªn google colab). Khi huáº¥n luyá»‡n trÃªn nhiá»u GPU thÃ¬ nÃªn giáº£m learning_rate xuá»‘ng theo cáº¥p sá»‘ nhÃ¢n. Cháº³ng háº¡n báº¡n huáº¥n luyá»‡n trÃªn 4 GPU thÃ¬ cáº§n thiáº¿t láº­p learning_rate má»›i báº±ng 1/4 learning_rate máº·c Ä‘á»‹nh trÃªn 1 GPU. QuÃ¡ trÃ¬nh huáº¥n luyá»‡n sáº½ nhanh hÆ¡n ráº¥t nhiá»u.</p>
  </li>
  <li>
    <p>Sá»­ dá»¥ng pretrain model trÃªn bá»™ dá»¯ liá»‡u gáº§n giá»‘ng vá»›i bá»™ dá»¯ liá»‡u Ä‘ang huáº¥n luyá»‡n. Khi Ä‘Ã³ cÃ¡c trá»ng sá»‘ cá»§a mÃ´ hÃ¬nh pretrain vÃ  mÃ´ hÃ¬nh tá»‘i Æ°u cho bá»™ dá»¯ liá»‡u sáº½ gáº§n sÃ¡t nhau. ChÃºng ta sáº½ chá»‰ cáº§n Ã­t steps huáº¥n luyá»‡n hÆ¡n Ä‘á»ƒ Ä‘áº¡t káº¿t quáº£ tá»‘t so vá»›i lá»±a chá»n pretrain model Ä‘Æ°á»£c huáº¥n luyá»‡n tá»« má»™t bá»™ dá»¯ liá»‡u khÃ¡c biá»‡t lá»›n.</p>
  </li>
  <li>
    <p>Update cuDNN version (Ä‘á»‘i vá»›i cÃ¡c báº¡n huáº¥n luyá»‡n trÃªn mÃ¡y tÃ­nh cÃ¡ nhÃ¢n, mÃ´i trÆ°á»ng xá»‹n sÃ² cá»§a google colab Ä‘Ã£ update sáºµn cuDNN). NhÆ° Ä‘Ã£ giá»›i thiá»‡u á»Ÿ má»¥c 1 cáº¥u hÃ¬nh cuDNN. Nhá»¯ng kiáº¿n trÃºc cuDNN má»›i Ä‘Ã£ Ä‘Æ°á»£c tá»‘i Æ°u hÆ¡n ráº¥t nhiá»u giÃºp tÄƒng tá»‘c quÃ¡ trÃ¬nh huáº¥n luyá»‡n. Sá»­ dá»¥ng cuDNN version 7.6 cÃ³ thá»ƒ tÄƒng tá»‘c gáº¥p 2 láº§n so vá»›i version 6.0. Do Ä‘Ã³ hÃ£y cáº­p nháº­t cuDNN náº¿u báº¡n Ä‘ang sá»­ dá»¥ng version cÅ©. NhÆ°ng lÆ°u Ã½ lÃ  cuDNN cáº§n tÆ°Æ¡ng thÃ­ch version vá»›i CUDA Ä‘á»ƒ trÃ¡nh cÃ¡c lá»—i phÃ¡t sinh nhÃ©.</p>
  </li>
  <li>
    <p>CÃ¢n nháº¯c sá»­ dá»¥ng kiáº¿n trÃºc Ä‘Æ¡n giáº£n. CÃ¡c kiáº¿n trÃºc cá»§a YOLO khÃ¡c Ä‘a dáº¡ng tÃ¹y thuá»™c vÃ o base network. CÃ¡c báº¡n xem láº¡i bÃ i giá»›i thiá»‡u vá» YOLO Ä‘á»ƒ hiá»ƒu rÃµ hÆ¡n kiáº¿n trÃºc nÃ y. Náº¿u má»™t sá»‘ tÃ¡c vá»¥ vá»›i Ã­t classes thÃ¬ chÃªnh lá»‡ch vá» Ä‘á»™ chÃ­nh xÃ¡c giá»¯a mÃ´ hÃ¬nh kiáº¿n trÃºc phá»©c táº¡p vÃ  Ä‘Æ¡n giáº£n sáº½ khÃ´ng quÃ¡ lá»›n. Báº¡n cÃ³ thá»ƒ Ä‘áº·t ra trÆ°á»›c cho mÃ¬nh má»™t tiÃªu chuáº©n vá» mAP cá»§a mÃ´ hÃ¬nh vÃ  huáº¥n luyá»‡n thá»­ vá»›i cÃ¡c model cÃ³ kiáº¿n trÃºc Ä‘Æ¡n giáº£n nhÆ° tiny YOLO. CÃ³ thá»ƒ nhá»¯ng mÃ´ hÃ¬nh nÃ y Ä‘Ã£ Ä‘áº¡t Ä‘Æ°á»£c tiÃªu chuáº©n. HÆ¡n ná»¯a tá»‘c Ä‘á»™ dá»± bÃ¡o nhanh vÃ  cÃ³ thá»ƒ triá»ƒn khai trÃªn cÃ¡c thiáº¿t bá»‹ IoT cáº¥u hÃ¬nh tháº¥p lÃ  má»™t trong nhá»¯ng Ä‘iá»ƒm cá»™ng cho cÃ¡c mÃ´ hÃ¬nh nhÆ° váº­y. Simple is the best!</p>
  </li>
</ul>

<h1 id="6-cÃ¡c-lÆ°u-Ã½-khi-huáº¥n-luyá»‡n-mÃ´-hÃ¬nh">6. CÃ¡c lÆ°u Ã½ khi huáº¥n luyá»‡n mÃ´ hÃ¬nh</h1>

<p>CÃ¡c lÆ°u Ã½ khi huáº¥n luyá»‡n model darknet</p>

<ul>
  <li>Äáº·t Ä‘Ãºng Ä‘Æ°á»ng link config data: Trong data file chÃºng ta khai bÃ¡o cÃ¡c Ä‘Æ°á»ng dáº«n tá»›i cÃ¡c file cáº¥u hÃ¬nh. CÃ¡c Ä‘Æ°á»ng dáº«n nÃ y náº¿u lÃ  Ä‘á»‹a chá»‰ tÆ°Æ¡ng Ä‘á»‘i pháº£i Ä‘Æ°á»£c cáº¥u hÃ¬nh theo vá»‹ trÃ­ mÃ  chÃºng ta run model Ä‘á»ƒ cÃ³ thá»ƒ truy cáº­p Ä‘Æ°á»£c. Ná»™i dung cá»§a nhá»¯ng file nÃ y nhÆ° sau:
    <ul>
      <li>Files train.txt vÃ  text.txt: ÄÃ¢y lÃ  nhá»¯ng files chá»©a Ä‘Æ°á»ng link tá»›i áº£nh. MÃ´ hÃ¬nh sáº½ load cÃ¡c áº£nh tá»« nhá»¯ng Ä‘Æ°á»ng links nÃ y Ä‘á»ƒ huáº¥n luyá»‡n vÃ  kiá»ƒm Ä‘á»‹nh. Do Ä‘Ã³ cÃ¡c Ä‘Æ°á»ng links trong 2 files nÃªn Ä‘Æ°á»£c Ä‘á»ƒ lÃ  Ä‘Æ°á»ng link tuyá»‡t Ä‘á»‘i Ä‘á»ƒ khÃ´ng gáº·p lá»—i khi chuyá»ƒn folders.</li>
      <li>File obj.names: File chá»©a tÃªn cá»§a cÃ¡c classes. Thá»© tá»± cá»§a tÃªn tá»« trÃªn xuá»‘ng dÆ°á»›i pháº£i Ä‘Æ°á»£c Ä‘áº·t Ä‘Ãºng vá»›i thá»© tá»± index cá»§a classes Ä‘Æ°á»£c khai bÃ¡o trong cÃ¡c file annotation cá»§a áº£nh (element Ä‘áº§u tiÃªn cá»§a cÃ¡c file<code class="highlighter-rouge">[image_id].txt</code>).</li>
      <li>Folder backup: LÃ  folder Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ backup káº¿t quáº£ cá»§a quÃ¡ trÃ¬nh huáº¥n luyá»‡n. Sau má»—i 1000 batches thÃ¬ model sáº½ Ä‘Æ°á»£c backup má»™t báº£n táº¡i Ä‘Ã¢y. ÄÆ°á»ng dáº«n nÃ y nÃªn Ä‘Æ°á»£c Ä‘á»ƒ theo vá»‹ trÃ­ tuyá»‡t Ä‘á»‘i Ä‘á»ƒ trÃ¡nh cÃ¡c lá»—i phÃ¡t sinh.</li>
    </ul>
  </li>
  <li>Cáº¥u hÃ¬nh model YOLO:
    <ul>
      <li>Thay Ä‘á»•i <code class="highlighter-rouge">classes</code>: Táº¥t cáº£ cÃ¡c tham sá»‘ <code class="highlighter-rouge">classes</code> pháº£i Ä‘Æ°á»£c Ä‘Æ°a vá» Ä‘Ãºng báº±ng sá»‘ lÆ°á»£ng <code class="highlighter-rouge">classes</code> cá»§a dá»¯ liá»‡u chÃºng ta Ä‘ang huáº¥n luyá»‡n. Máº·c Ä‘á»‹nh cá»§a nhá»¯ng file cáº¥u hÃ¬nh Ä‘ang Ä‘á»ƒ lÃ  80 chÃ­nh lÃ  sá»‘ lÆ°á»£ng classes cá»§a COCO dataset.</li>
      <li>Thay Ä‘á»•i <code class="highlighter-rouge">filters</code> á»Ÿ layers cuá»‘i cÃ¹ng: CÃ¡c filters cá»§a layer cuá»‘i cÃ¹ng pháº£i Ä‘Æ°á»£c Ä‘iá»u chá»‰nh theo sá»‘ lÆ°á»£ng classes theo cÃ´ng thá»©c <code class="highlighter-rouge">(num_classes+5)x3</code>. Trong Ä‘Ã³ <code class="highlighter-rouge">num_classes</code> lÃ  kÃ­ch thÆ°á»›c cá»§a vÃ©c tÆ¡ phÃ¢n phá»‘i xÃ¡c suáº¥t toÃ n bá»™ classes Ä‘áº§u ra vÃ  5 lÃ  sá»‘ lÆ°á»£ng cÃ¡c tham sá»‘ bao gá»“m 4 tham sá»‘ cá»§a tá»a Ä‘á»™ <code class="highlighter-rouge">&lt;bbox-x-ratio&gt; &lt;bbox-y-ratio&gt; &lt;bbox-width-ratio&gt; &lt;bbox-height-ratio&gt;</code> vÃ  1 tham sá»‘ $p_x$ dá»± bÃ¡o xÃ¡c suáº¥t cÃ³ váº­t thá»ƒ trong anchor box hay khÃ´ng. 3 chÃ­nh lÃ  sá»‘ lÆ°á»£ng cÃ¡c anchors.</li>
    </ul>
  </li>
  <li>Thay Ä‘á»•i tham sá»‘ huáº¥n luyá»‡n model:
    <ul>
      <li>Sá»‘ lÆ°á»£ng batches huáº¥n luyá»‡n: Äá»‘i vá»›i bá»™ dá»¯ liá»‡u cÃ³ sá»‘ lÆ°á»£ng classes lá»›n (khoáº£ng vÃ i chá»¥c classes) thÃ¬ sá»‘ lÆ°á»£ng batches huáº¥n luyá»‡n (tham sá»‘ <code class="highlighter-rouge">max_batches</code>) Ã­t nháº¥t khoáº£ng 50000 lÃ  cÃ³ thá»ƒ Ä‘áº¡t Ä‘Æ°á»£c káº¿t quáº£ tá»‘t. Äá»‘i vá»›i bá»™ dá»¯ liá»‡u cÃ³ sá»‘ lÆ°á»£ng classes nhá» (&lt;5 classes) thÃ¬ <code class="highlighter-rouge">max_batches</code> chá»‰ cáº§n khoáº£ng 4000 Ä‘Ã£ cÃ³ thá»ƒ thu Ä‘Æ°á»£c káº¿t quáº£ tá»‘t. QÃºa trÃ¬nh huáº¥n luyá»‡n nÃ y tá»‘n khÃ¡ nhiá»u thá»i gian. Äá»‘i vá»›i 50000 batches vá»›i kÃ­ch thÆ°á»›c batch_size = 16 cÃ³ thá»ƒ tá»‘n 2-3 ngÃ y huáº¥n luyá»‡n trÃªn 1 GPU.</li>
      <li>Mini-batch pháº£i fit vá»›i RAM: Tham sá»‘ <code class="highlighter-rouge">subdivisions</code> sáº½ khai bÃ¡o sá»‘ lÆ°á»£ng cÃ¡c mini-batch Ä‘Æ°á»£c chia ra tá»« 1 batch Ä‘á»ƒ Ä‘Æ°a vÃ o mÃ´ hÃ¬nh huáº¥n luyá»‡n. Náº¿u <code class="highlighter-rouge">batch_size = 64, subdivisions = 8</code> thÃ¬ kÃ­ch thÆ°á»›c cá»§a <code class="highlighter-rouge">mini-batch = batch_size/8 = 8</code> áº£nh. Sá»‘ lÆ°á»£ng cÃ¡c khung hÃ¬nh Ä‘Æ°á»£c sinh ra tá»« má»™t áº£nh lÃ  ráº¥t lá»›n nÃªn dÃ¹ chá»‰ 8 áº£nh cÅ©ng cÃ³ thá»ƒ vÆ°á»£t quÃ¡ kÃ­ch thÆ°á»›c RAM. Äá»‘i vá»›i cáº¥u hÃ¬nh cá»§a google colab kÃ­ch thÆ°á»›c 12GB RAM thÃ¬ chÃºng ta cÃ³ thá»ƒ fit Ä‘Æ°á»£c 4 áº£nh.</li>
      <li>Cáº¥u hÃ¬nh tham sá»‘ huáº¥n luyá»‡n: QÃºa trÃ¬nh huáº¥n luyá»‡n cÃ¡c máº¡ng neural cho tháº¥y cÃ¡c steps Ä‘áº§u tiÃªn nÃªn dÆ°á»£c thiáº¿t láº­p vá»›i learning rate ráº¥t nhá» Ä‘á»ƒ mÃ´ hÃ¬nh khÃ´ng step khá»i global optimal. Do Ä‘Ã³ tham sá»‘ <code class="highlighter-rouge">burn_in=1000</code> cho phÃ©p learning rate cá»§a chÃºng ta tÄƒng dáº§n tá»« 0 tá»›i <code class="highlighter-rouge">learning_rate</code> trong 1000 steps Ä‘áº§u tiÃªn. Sau Ä‘Ã³ <code class="highlighter-rouge">learning_rate</code> sáº½ Ä‘Æ°á»£c giá»¯ nguyÃªn. VÃ  Ä‘áº¿n cÃ¡c batch á»Ÿ vá»‹ trÃ­ gáº§n cuá»‘i nhÆ° <code class="highlighter-rouge">80%</code> hoáº·c <code class="highlighter-rouge">90%</code> thÃ¬ chÃºng ta sáº½ giáº£m <code class="highlighter-rouge">learning_rate</code> xuá»‘ng vá»›i tá»‘c Ä‘á»™ giáº£m lÃ  10 láº§n. á» nhá»¯ng vá»‹ trÃ­ nÃ y model gáº§n Ä‘áº¡t tá»›i global optimal nÃªn khÃ´ng cáº§n pháº£i giá»¯ <code class="highlighter-rouge">learning_rate</code> quÃ¡ cao.</li>
    </ul>
  </li>
  <li>
    <p>NÃªn backup láº¡i log cá»§a quÃ¡ trÃ¬nh huáº¥n luyá»‡n: quÃ¡ trÃ¬nh huáº¥n luyá»‡n nÃªn Ä‘Æ°á»£c backup láº¡i trÃªn má»™t file log Ä‘á»ƒ cÃ³ thá»ƒ visualize sau huáº¥n luyá»‡n loss function. Nhá»¯ng Ä‘á»“ thá»‹ nÃ y sáº½ giÃºp Ã­ch cho chÃºng ta tÃ¬m kiáº¿m cÃ¡c tham sá»‘ schedule learning tá»‘i Æ°u cho nhá»¯ng Ä‘á»£t huáº¥n luyá»‡n sau.</p>
  </li>
  <li>Lá»—i <code class="highlighter-rouge">Unable to init server: Could not connect: Connection refused</code>: ÄÃ¢y lÃ  lá»—i xuáº¥t hiá»‡n khi huáº¥n luyá»‡n trÃªn google colab. Lá»—i liÃªn quan tá»›i viá»‡c sá»­ dá»¥ng GUI cá»§a <code class="highlighter-rouge">opencv</code>. Google colab Ä‘Ã£ disable chá»©c nÄƒng cá»§a GUI khiáº¿n cho code bá»‹ dá»«ng. ChÃºng ta cÃ³ thá»ƒ chuyá»ƒn tiáº¿p lá»—i nÃ y báº±ng cÃ¡ch pass thÃªm argument <code class="highlighter-rouge">-dont_show</code>.</li>
</ul>

<h1 id="7-tá»•ng-káº¿t">7. Tá»•ng káº¿t</h1>

<p>NhÆ° váº­y tÃ´i Ä‘Ã£ giá»›i thiá»‡u Ä‘áº¿n cÃ¡c báº¡n cÃ¡c bÆ°á»›c chi tiáº¿t Ä‘á»ƒ huáº¥n luyá»‡n má»™t mÃ´ hÃ¬nh YOLO trÃªn project darknet. Viá»‡c huáº¥n luyá»‡n mÃ´ hÃ¬nh sáº½ Ä‘Ã²i há»i cÃ¡c báº¡n pháº£i cÃ³ mÃ¡y tÃ­nh cáº¥u hÃ¬nh cao, cÃ³ há»— trá»£ GPU. Tuy nhiÃªn vá»›i cÃ¡c báº¡n sinh viÃªn nghÃ¨o vÆ°á»£t khÃ³ hoáº·c sinh viÃªn giÃ u nhÆ°ng tiáº¿t kiá»‡m cÃ³ thá»ƒ Ã¡p dá»¥ng hÆ°á»›ng dáº«n nÃ y Ä‘á»ƒ tá»± huáº¥n luyá»‡n model mÃ´ hÃ¬nh cho cÃ¡c tÃ¡c vá»¥ object detection cá»§a mÃ¬nh trÃªn google colab mÃ  khÃ´ng cáº§n pháº£i lo láº¯ng.</p>

<p>Code cá»§a project nÃ y Ä‘Ã£ Ä‘Æ°á»£c tá»•ng há»£p trÃªn git repo <a href="https://github.com/phamdinhkhanh/darknetGoogleColab">darknetGoogleColab</a>. CÃ¡c lá»—i phÃ¡t sinh Ä‘Ã£ Ä‘Æ°á»£c note khÃ¡ chi tiáº¿t á»Ÿ má»¥c <strong>6. CÃ¡c lÆ°u Ã½ khi huáº¥n luyá»‡n mÃ´ hÃ¬nh</strong>. Äá»ƒ thá»±c hÃ nh nhanh chÃ³ng, báº¡n cÃ³ thá»ƒ má»Ÿ file <a href="https://colab.research.google.com/drive/1G3AM3CHsMb0iwuBDR-j5rimr_WX2KHc2">darknetGoogleColab.ipynb</a> vÃ  thá»±c hiá»‡n tá»« bÆ°á»›c <strong>3.2. Enable GPU trÃªn google colab</strong>. Náº¿u gáº·p lá»—i phÃ¡t sinh, vui lÃ²ng táº¡o má»™t issue trÃªn git repo:</p>

<p><img src="https://imgur.com/GDEBobU.png" class="largepic" /></p>

<p>TÃ´i khuyáº¿n nghá»‹ cÃ¡c báº¡n Ä‘á»c qua thuáº­t toÃ¡n YOLO táº¡i <a href="https://phamdinhkhanh.github.io/2020/03/09/DarknetAlgorithm.html">BÃ i 25 - YOLO You Only Look Once</a> Ä‘á»ƒ hiá»ƒu má»™t chÃºt vá» lÃ½ thuyáº¿t.</p>

<h1 id="8-tÃ i-liá»‡u-tham-kháº£o">8. TÃ i liá»‡u tham kháº£o</h1>

<ol>
  <li><a href="https://github.com/phamdinhkhanh/darknetGoogleColab">phamdinhkhanh - darknet git repo</a></li>
  <li><a href="https://phamdinhkhanh.github.io/2020/03/09/DarknetAlgorithm.html">BÃ i 25 - YOLO You Only Look Once - Khanh blog</a></li>
  <li><a href="https://github.com/pjreddie/darknet">pjreddie - darknet git repo</a></li>
  <li><a href="https://github.com/AlexeyAB/darknet">AlexeyAB - darknet git repo</a></li>
  <li><a href="https://phamdinhkhanh.github.io/2020/03/09/DarknetAlgorithm.html">BÃ i 25 - YOLO You Only Look Once</a></li>
</ol>

<script data-ad-client="ca-pub-4263248182804679" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>

<script src="/js/toc.js"></script>
<script src="/js/btnTop.js"></script>
<script type="text/javascript">
$(document).ready(function() {
    $('#toc').toc();
});
</script>
				</div>
			</div>
			<div class="col-md-2 hidden-xs hidden-sm">
				<a  href="/">
					<img width="100%" style="padding-bottom: 3mm;" src="/assets/images/logo.jpg" /> </a>
				<br>
				<nav>
					<div class="header">Khanh's site</div>
					<li><a style="text-align: left; color: #074B80"  href="https://www.facebook.com/TowardDataScience">phamdinhkhanh blog</a></li>
					<li><a style="text-align: left; color: #074B80"  href="https://www.facebook.com/groups/3235479620010379/">phamdinhkhanh AICode forum</a></li>
					<li><a style="text-align: left; color: #074B80"  href="https://kaggle.com/phamdinhkhanh">phamdinhkhanh kaggle</a></li>
					<li><a style="text-align: left; color: #074B80"  href="http://rpubs.com/phamdinhkhanh">phamdinhkhanh rpub</a></li>
					<li><a style="text-align: left; color: #074B80"  href="https://github.com/phamdinhkhanh">phamdinhkhanh github</a></li>
					<br>
					<div class="header">other's site</div>
					<li><a style="text-align: left; color: #074B80"  href="https://www.facebook.com/groups/machinelearningcoban/">machine learning cÆ¡ báº£n facebook</a></li>
					<li><a style="text-align: left; color: #074B80"  href="https://forum.machinelearningcoban.com/">machine learning cÆ¡ báº£n forum</a></li>
					<li><a style="text-align: left; color: #074B80"  href="https://machinelearningmastery.com">machine learning mastery</a></li>
					<li><a style="text-align: left; color: #074B80"  href="https://viblo.asia">viblosia</a></li>
					<br>
					<div class="header">KhÃ³a há»c</div>
					<li><a style="text-align: left; color: #074B80"  href="http://web.stanford.edu/class/cs109/">XÃ¡c suáº¥t thá»‘ng kÃª(Probability): CS109</a></li>
					<li><a style="text-align: left; color: #074B80"  href="http://web.stanford.edu/class/cs246/">Bigdata: CS246</a></li>
					<li><a style="text-align: left; color: #074B80"  href="http://cs231n.stanford.edu/">Computer vision cÆ¡ báº£n: CS231N</a></li>
					<li><a style="text-align: left; color: #074B80"  href="http://web.stanford.edu/class/cs224n/">Natural Language Processing: CS224N</a></li>
					<li><a style="text-align: left; color: #074B80"  href="http://web.stanford.edu/class/cs224w/">KhoÃ¡ phÃ¢n tÃ­ch máº¡ng lÆ°á»›i (analysis of network): CS224W</a></li>
					<li><a style="text-align: left; color: #074B80"  href="https://web.stanford.edu/class/cs20si/">KhÃ³a há»c Tensorflow: CS20SI</a></li>
				</nav>
			</div>
		</div>
	</div>
	
</body>
</html>
